<app-navbar></app-navbar>

<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-6xl mx-auto px-4">
    
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">
        Mis Servicios Solicitados
      </h1>
      <p class="text-gray-600">Historial completo de tus solicitudes de servicio</p>
    </div>

    <!-- Loading -->
    @if (isLoading()) {
      <div class="flex justify-center items-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"></div>
      </div>
    }

    <!-- No hay solicitudes -->
    @else if (requests().length === 0) {
      <div class="bg-white rounded-lg shadow-sm p-12 text-center">
        <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">
          construction
        </span>
        <h2 class="text-xl font-semibold text-gray-900 mb-2">No tienes solicitudes de servicio aún</h2>
        <p class="text-gray-600 mb-6">¡Solicita un servicio y aparecerá aquí!</p>
        <a 
          routerLink="/services" 
          class="inline-flex items-center gap-2 bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600 transition-colors">
          <span class="material-symbols-outlined">build</span>
          Ver servicios
        </a>
      </div>
    }

    <!-- Lista de solicitudes -->
    @else {
      <div class="space-y-6">
        @for (request of requests(); track request.id) {
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow">
            
            <!-- Header de la solicitud -->
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">Solicitud #{{ request.id }}</h3>
                  <p class="text-sm text-gray-600">
                    <span class="material-symbols-outlined text-sm align-middle">schedule</span>
                    Solicitado: {{ formatDate(request.date_requested!) }}
                  </p>
                </div>
                <div class="flex items-center gap-3">
                  <span 
                    [class]="getStatusBadgeClass(request.status)"
                    class="px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">{{ getStatusIcon(request.status) }}</span>
                    {{ getStatusText(request.status) }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Información del servicio -->
            <div class="px-6 py-4 bg-blue-50 border-b border-blue-100">
              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-blue-600">construction</span>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-900">{{ request.service_name }}</h4>
                  <p class="text-sm text-gray-600 mt-1">{{ request.service_description }}</p>
                </div>
              </div>
            </div>

            <!-- Detalles de la cita -->
            <div class="px-6 py-4">
              <h4 class="text-sm font-semibold text-gray-700 mb-3">
                <span class="material-symbols-outlined text-sm align-middle">event</span>
                Detalles de la Cita:
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-center gap-2 text-sm">
                  <span class="material-symbols-outlined text-gray-500">calendar_today</span>
                  <div>
                    <p class="text-gray-600">Fecha y Hora Agendada</p>
                    <p class="font-medium text-gray-900">{{ formatDateTime(request.scheduled_date) }}</p>
                  </div>
                </div>
                <div class="flex items-center gap-2 text-sm">
                  <span class="material-symbols-outlined text-gray-500">location_on</span>
                  <div>
                    <p class="text-gray-600">Dirección</p>
                    <p class="font-medium text-gray-900">{{ request.customer_address }}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Datos de contacto -->
            <div class="px-6 py-3 bg-gray-50 border-t border-gray-200">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                <div class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-sm text-gray-500">person</span>
                  <span class="text-gray-900">{{ request.customer_name }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-sm text-gray-500">phone</span>
                  <span class="text-gray-900">{{ request.customer_phone }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-sm text-gray-500">email</span>
                  <span class="text-gray-900">{{ request.customer_email }}</span>
                </div>
              </div>
            </div>

            <!-- Notas del cliente (si existen) -->
            @if (request.customer_notes) {
              <div class="px-6 py-3 bg-amber-50 border-t border-amber-100">
                <p class="text-sm">
                  <span class="material-symbols-outlined text-sm align-middle text-amber-600">note</span>
                  <span class="font-medium text-gray-700">Tus notas:</span>
                  <span class="text-gray-600 ml-2">{{ request.customer_notes }}</span>
                </p>
              </div>
            }

            <!-- Respuesta del admin (si fue rechazado o hay nota) -->
            @if (request.status === 'RECHAZADO' && request.rejection_reason) {
              <div class="px-6 py-3 bg-red-50 border-t border-red-100">
                <p class="text-sm">
                  <span class="material-symbols-outlined text-sm align-middle text-red-600">info</span>
                  <span class="font-medium text-red-700">Motivo de rechazo:</span>
                  <span class="text-red-600 ml-2">{{ request.rejection_reason }}</span>
                </p>
              </div>
            }

            @if (request.admin_note) {
              <div class="px-6 py-3 bg-green-50 border-t border-green-100">
                <p class="text-sm">
                  <span class="material-symbols-outlined text-sm align-middle text-green-600">chat</span>
                  <span class="font-medium text-green-700">Nota del administrador:</span>
                  <span class="text-green-600 ml-2">{{ request.admin_note }}</span>
                </p>
              </div>
            }

          </div>
        }
      </div>
    }

  </div>
</div>