<app-navbar></app-navbar>

<main class="min-h-screen bg-surface">
  <!-- Header -->
  <section class="bg-primary text-black">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
      <h1 class="text-4xl md:text-5xl font-bold mb-2">Nuestros Servicios</h1>
      <p class="text-black">Soluciones técnicas profesionales para tu negocio</p>
    </div>
  </section>

  <!-- Services Grid -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-2">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16 items-stretch">
      @for (service of services(); track service.title) {
      <app-card [hover]="true" class="h-full">
        <div class="flex gap-4 mb-4">
          <div class="bg-primary/10 p-4 rounded-xl flex-shrink-0">
            <!-- (tu icono svg aquí si lo usas) -->
            <span class="material-symbols-outlined text-primary">construction</span>
          </div>
          <div>
            <h3 class="text-xl font-semibold">{{ service.title }}</h3>
            <p class="text-sm text-gray-500">{{ service.duration }}</p>
          </div>
        </div>

        <p class="text-text-secondary mb-4 flex-grow">{{ service.description }}</p>

        <ul class="space-y-2 mb-6 flex-grow">
          @for (feature of service.features; track feature) {
          <li class="flex gap-2 text-sm">
            <span class="text-primary font-bold">✓</span>
            <span class="text-text-secondary">{{ feature }}</span>
          </li>
          }
        </ul>

        <div class="flex justify-between items-center">
          <span class="text-lg font-bold text-primary">{{ service.price }}</span>
          <app-button (click)="openModal(service)">Solicitar servicio</app-button>
        </div>
      </app-card>
      }
    </div>

    <!-- (opcional) Why & CTA aquí -->
  </div>
</main>

<!-- ================= MODAL ================= -->
@if (isModalOpen()) {
<div class="fixed inset-0 z-50 flex items-center justify-center">
  <!-- overlay -->
  <div class="absolute inset-0 bg-black/40" (click)="closeModal()"></div>

  <!-- dialog -->
  <div
    class="relative bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4 overflow-hidden h-full max-h-[95vh] flex flex-col">
    <!-- header -->
    <div class="flex items-center justify-between px-6 py-4 border-b flex-shrink-0">
      <div>
        <h3 class="text-xl font-semibold">Solicitar servicio</h3>
        <p class="text-sm text-gray-500">{{ selectedService()?.title }}</p>
      </div>
      <button class="p-2 rounded-md hover:bg-gray-100" (click)="closeModal()">✕</button>
    </div>

    <!-- body -->
    <div class="overflow-y-auto flex-1">
      @if (!isSubmitted()) {
      <!-- Formulario normal -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6 bg-gray-50">
        <!-- Steps -->
        <div class="lg:col-span-2">
          <!-- tabs -->
          <div class="flex gap-6 mb-6">
            <div class="pb-2 border-b-2" [class.border-primary]="modalStep()===1"
              [class.border-transparent]="modalStep()!==1">
              <span class="text-sm" [class.text-primary]="modalStep()===1" [class.text-gray-500]="modalStep()!==1">1.
                Fecha y Hora</span>
            </div>
            <div class="pb-2 border-b-2" [class.border-primary]="modalStep()===2"
              [class.border-transparent]="modalStep()!==2">
              <span class="text-sm" [class.text-primary]="modalStep()===2" [class.text-gray-500]="modalStep()!==2">2.
                Detalles</span>
            </div>
          </div>

          <!-- STEP 1 -->
          @if (modalStep() === 1) {
          <div class="bg-white rounded-xl p-5 shadow-sm">
            <h4 class="font-semibold mb-4">Selecciona Fecha y Hora</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-2">Fecha</label>
                <input type="date" (input)="date.set($any($event.target).value)"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Hora</label>
                <select
                  class="text- w-full px-2 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary"
                  [value]="time()" (change)="onTimeChange($event)">
                  <option value=""disabled>Selecciona una hora</option>
                  @for (h of hours; track h) {
                  <option [value]="h">{{ h }}</option>
                  }
                </select>
              </div>
            </div>

            <div class="flex justify-end mt-6">
              <app-button [disabled]="!date() || !time()" (click)="nextStep()">Continuar</app-button>
            </div>
          </div>
          }

          <!-- STEP 2 -->
          @if (modalStep() === 2) {
          <div class="bg-white rounded-xl p-5 shadow-sm">
            <h4 class="font-semibold mb-4">Detalles del Servicio</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-2">Nombre</label>
                <input type="text" (input)="name.set($any($event.target).value)"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Teléfono</label>
                <input type="text" (input)="phone.set($any($event.target).value)"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-2">Dirección</label>
                <input type="text" (input)="address.set($any($event.target).value)"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-2">Notas (opcional)</label>
                <textarea rows="3"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary resize-none"
                  [value]="notes()" (input)="onNotesChange($event)"></textarea>
              </div>
            </div>

            <div class="flex items-center justify-between mt-6">
              <button class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100" (click)="prevStep()">
                Volver
              </button>
              <app-button [disabled]="!name() || !phone() || !address()" (click)="submitRequest()">Confirmar solicitud</app-button>
            </div>
          </div>
          }
        </div>

        <!-- Resumen -->
        <aside class="lg:col-span-1">
          <div class="bg-white rounded-xl p-5 shadow-sm sticky top-4">
            <h4 class="font-semibold mb-4">Resumen</h4>
            <div class="space-y-3 text-sm text-gray-700">
              <div class="flex items-start gap-2">
                <span class="material-symbols-outlined text-primary">sell</span>
                <div>
                  <p class="font-medium">{{ selectedService()?.title }}</p>
                  <p class="text-gray-500">{{ selectedService()?.description }}</p>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">schedule</span>
                <p>{{ selectedService()?.duration || 'Según proyecto' }}</p>
              </div>
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">location_on</span>
                <p>{{ address() || 'Dirección a confirmar' }}</p>
              </div>
              <div class="pt-3 border-t">
                <p class="text-xs text-gray-500">Precio Base</p>
                <p class="text-2xl font-bold text-primary">
                  {{ selectedService()?.price }}
                </p>
              </div>
            </div>
          </div>
        </aside>
      </div>
      } @else {
      <!-- Pantalla de confirmación -->
      <div class="p-6 bg-gray-50">
        <div class="max-w-2xl mx-auto">
          <!-- Icono de éxito -->
          <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-4">
              <span class="material-symbols-outlined text-green-600 text-5xl">check_circle</span>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">
              ¡Solicitud Enviada Correctamente!
            </h3>
            <p class="text-gray-600">
              Hemos recibido tu solicitud. Te contactaremos pronto para confirmar los detalles.
            </p>
          </div>

          <!-- Estado -->
          <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
            <div class="flex items-center gap-3">
              <span class="material-symbols-outlined text-amber-600">schedule</span>
              <div>
                <p class="font-semibold text-amber-900">Estado: Pendiente de Aprobación</p>
                <p class="text-sm text-amber-700">Revisaremos tu solicitud y te confirmaremos la disponibilidad</p>
              </div>
            </div>
          </div>

          <!-- Resumen de datos -->
          <div class="bg-white rounded-xl p-6 shadow-sm space-y-4">
            <h4 class="font-semibold text-lg border-b pb-2">Resumen de tu Solicitud</h4>

            <div class="grid gap-4">
              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-primary">construction</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Servicio</p>
                  <p class="font-medium text-gray-900">{{ selectedService()?.title }}</p>
                </div>
              </div>

              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-primary">calendar_today</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Fecha y Hora</p>
                  <p class="font-medium text-gray-900">{{ date() }} - {{ time() }}</p>
                </div>
              </div>

              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-primary">person</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Cliente</p>
                  <p class="font-medium text-gray-900">{{ name() }}</p>
                </div>
              </div>

              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-primary">phone</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Teléfono</p>
                  <p class="font-medium text-gray-900">{{ phone() }}</p>
                </div>
              </div>

              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-primary">location_on</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Dirección</p>
                  <p class="font-medium text-gray-900">{{ address() }}</p>
                </div>
              </div>

              @if (notes()) {
              <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-primary">note</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Notas</p>
                  <p class="font-medium text-gray-900">{{ notes() }}</p>
                </div>
              </div>
              }

              <div class="flex items-start gap-3 pt-4 border-t">
                <span class="material-symbols-outlined text-primary">payments</span>
                <div class="flex-1">
                  <p class="text-sm text-gray-500">Precio Base</p>
                  <p class="text-2xl font-bold text-primary">{{ selectedService()?.price }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Botón cerrar -->
          <div class="mt-6 text-center">
            <button class="px-8 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 font-medium"
              (click)="closeModal()">
              Cerrar
            </button>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</div>
}