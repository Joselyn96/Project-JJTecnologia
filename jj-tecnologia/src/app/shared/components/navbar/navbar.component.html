<!-- Main Navbar -->
<nav [class]="isScrolled() ? 'bg-[#3C5F94] shadow-lg' : 'bg-white shadow-sm'"
  class="border-b border-gray-200 sticky top-0 z-40 transition-all duration-300">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center py-4">

      <!-- Logo -->
      <a routerLink="/" [ngClass]="isScrolled() ? 'text-white' : 'text-blue-600'"
        class="text-2xl font-serif font-bold hover:opacity-80 transition-all">
        @if(!isScrolled()){
        <img class="h-12 md:h-16 object-contain" src="logo_navbar_blanco.png" alt="JJ Tecnologia Logo">
        }
      </a>

      <!-- Desktop Menu -->
      <div class="hidden md:flex gap-8">
        @for (link of navLinks; track link.href) {
        <a [routerLink]="link.href" routerLinkActive="text-primary-500 underline decoration-2 underline-offset-4"
          [routerLinkActiveOptions]="{exact: link.href === '/'}" class="transition-colors" [ngClass]="{
     'text-white': isScrolled(),
     'text-gray-700 hover:text-primary-500': !isScrolled()
   }">
          {{ link.label }}
        </a>
        }
      </div>

      <!-- Desktop Actions -->
      <div class="hidden md:flex gap-3 items-center">

        <button (click)="goToCart()" class="cursor-pointer relative p-2 rounded-lg transition-colors">
          <span class="material-symbols-outlined" [ngClass]="isScrolled() ? 'text-white' : 'text-gray-700'">
            shopping_cart
          </span>
          @if (cartCount() > 0) {
          <span
            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-medium">
            {{ cartCount() }}
          </span>
          }
        </button>

        <!-- Botón de login/logout -->
        @if (authService.isAuthenticated()) {
        <!-- Usuario logueado -->
        <div class="relative">
  <!-- Botón del usuario -->
  <button 
    (click)="toggleUserMenu()"
    class="cursor-pointer flex items-center gap-2 px-3 py-2 rounded-lg transition-colors"
    [ngClass]="isScrolled() ? 'text-white' : 'text-gray-700 hover:bg-gray-100'">
    <span class="material-symbols-outlined">account_circle</span>
    <span class="text-sm">
      {{ authService.userProfile()?.full_name || authService.currentUser()?.email }}
    </span>
    <span class="material-symbols-outlined text-sm">
      {{ isUserMenuOpen() ? 'expand_less' : 'expand_more' }}
    </span>
  </button>

  <!-- Menú desplegable -->
  @if (isUserMenuOpen()) {
    <div class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50">
      <!-- Opción: Mis Pedidos -->
      <a 
        routerLink="/my-orders"
        (click)="closeUserMenu()"
        class="flex items-center gap-3 px-4 py-3 hover:bg-gray-100 transition-colors text-gray-700">
        <span class="material-symbols-outlined text-primary-500">receipt_long</span>
        <span class="font-medium">Mis Pedidos</span>
      </a>

      <!-- Divisor -->
      <div class="border-t border-gray-200 my-2"></div>

      <!-- Opción: Cerrar Sesión -->
      <button 
        (click)="logout()"
        class="cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-gray-100 transition-colors text-gray-700 w-full text-left">
        <span class="material-symbols-outlined text-red-500">logout</span>
        <span class="font-medium">Cerrar Sesión</span>
      </button>
    </div>
  }
</div>
        } @else {
        <!-- Botón de login -->
        <button (click)="openAuthModal()"
            [class]="isScrolled() ? ' hover:bg-primary-500 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
            class="flex items-center justify-center gap-2 w-full px-4 py-2 rounded-lg transition-colors text-sm font-medium cursor-pointer">
            <span class="material-symbols-outlined text-base">account_circle</span>
            <span>Iniciar Sesión</span>
          </button>
        }
      </div>

      <!-- Mobile Menu Button -->
      <button [class]="isScrolled() ? 'hover:bg-blue-700' : 'hover:bg-gray-100'"
        class="md:hidden p-2 rounded-lg transition-colors" (click)="toggleMenu()" aria-label="Toggle menu">
        <span [class]="isScrolled() ? 'text-white' : 'text-gray-700'" class="material-symbols-outlined">
          @if (isOpen()) {
          close
          } @else {
          menu
          }
        </span>
      </button>
    </div>

    <!-- Mobile Menu -->
    @if (isOpen()) {
    <div [class]="isScrolled() ? 'bg-blue-800' : 'bg-gray-50'" class="md:hidden border-t border-gray-200 py-4">
      <div class="flex flex-col gap-4">

        <!-- Links -->
        @for (link of navLinks; track link.href) {
        <a [routerLink]="link.href" routerLinkActive="text-primary-400"
          [routerLinkActiveOptions]="{exact: link.href === '/'}"
          [class]="isScrolled() ? 'text-white hover:text-primary-500' : 'text-gray-700 hover:text-primary-500'"
          class="transition-colors px-2" (click)="toggleMenu()">
          {{ link.label }}
        </a>
        }

        <!-- Actions -->
        <div class="flex flex-col gap-2 pt-4 border-t border-gray-200">

          <!-- Shopping Cart Mobile -->
          <button
            [class]="isScrolled() ? 'bg-blue-700 hover:bg-blue-900 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
            class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors text-sm font-medium">
            <span class="material-symbols-outlined">shopping_cart</span>
            Carrito
            @if (cartCount() > 0) {
            <span
              class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-medium">
              {{ cartCount() }}
            </span>
            }
          </button>

          <!-- Login Button Mobile -->
          @if (authService.isAuthenticated()) {
          <button (click)="logout()"
            [class]="isScrolled() ? 'bg-blue-700 hover:bg-blue-900 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
            class="flex items-center justify-center gap-2 w-full px-4 py-2 rounded-lg transition-colors text-sm font-medium cursor-pointer">
            <span class="material-symbols-outlined text-base">logout</span>
            <span>Cerrar sesión</span>
          </button>
          } @else {
          <button (click)="openAuthModal()"
            [class]="isScrolled() ? 'bg-blue-700 hover:bg-blue-900 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
            class="flex items-center justify-center gap-2 w-full px-4 py-2 rounded-lg transition-colors text-sm font-medium cursor-pointer">
            <span class="material-symbols-outlined text-base">account_circle</span>
            <span>Iniciar Sesión</span>
          </button>
          }
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Modal de autenticación -->
  @if (showAuthModal()) {
  <app-auth-modal (close)="closeAuthModal()" />
  }
</nav>